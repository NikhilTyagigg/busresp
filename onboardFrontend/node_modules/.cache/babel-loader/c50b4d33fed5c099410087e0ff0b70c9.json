{"ast":null,"code":"import axios from \"axios\";\nimport LocalStorageService from './localstorage.service';\nimport { config } from '../configs';\nimport { apiURL } from '../configs';\nimport { Message } from \"../utility/constants/message\";\nconst localStorageService = LocalStorageService.getService();\nexport const axiosInstance = axios.create({\n  baseURL: config.baseURL,\n  headers: {\n    \"Content-Type\": \"application/json\"\n  }\n});\naxiosInstance.interceptors.request.use(config => {\n  const token = localStorageService.getAccessToken();\n  if (token) {\n    config.headers['Authorization'] = 'Bearer ' + token;\n  }\n  return config;\n}, error => {\n  Promise.reject(error);\n});\naxiosInstance.interceptors.response.use(response => {\n  return response;\n}, function (error) {\n  const originalRequest = error.config;\n  if (error && error.response && error.response.status === 401 && !originalRequest._retry) {\n    originalRequest._retry = true;\n    const refreshToken = localStorageService.getRefreshToken();\n    var headers = {\n      //Authorization: 'Bearer ' + refreshToken,\n      // refresh: refreshToken\n      'Content-type': 'application/json'\n    };\n    return axios({\n      method: 'post',\n      url: apiURL.LOGIN_REFRESH_TOKEN,\n      data: {\n        'refresh': refreshToken\n      },\n      headers: headers\n    }).then(response => {\n      if (response.status === 200) {\n        localStorageService.setTokenAfterRefreshToken(response.data.access);\n        axios.defaults.headers.common['Authorization'] = 'Bearer ' + response.data.access;\n        originalRequest.headers.Authorization = 'Bearer ' + response.data.access;\n        return axios(originalRequest);\n      }\n    }).catch(error => {\n      localStorageService.clearToken();\n      localStorageService.clearLocalStorage();\n      window.location = '/';\n    });\n  }\n  return Promise.reject(handleError(error));\n});\nconst handleError = error => {\n  var _error$response, _error$response$data, _error$response3, _error$response3$data, _error$response3$data2, _error$response5, _error$response5$data, _error$response6;\n  const returnErrorResponse = {\n    status: 'Failed',\n    message: 'Oops!!! Something went wrong at our end. Please try again after a minute'\n  };\n  if ((error === null || error === void 0 ? void 0 : (_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.detail) != undefined) {\n    var _error$response$data2, _error$response2, _error$response2$data;\n    returnErrorResponse.status = (_error$response$data2 = error.response.data) !== null && _error$response$data2 !== void 0 && _error$response$data2.status ? (_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.status : null;\n    if (error.response.data.detail == \"PLAN_EXPIRED\") {\n      returnErrorResponse.message = Message.PLAN_EXPIRED;\n    } else if (error.response.data.detail == \"ALL_CREDITS_USED\") {\n      returnErrorResponse.message = Message.ALL_CREDITS_USED;\n    } else {\n      returnErrorResponse.message = error.response.data.detail;\n    }\n  } else if ((error === null || error === void 0 ? void 0 : (_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : (_error$response3$data = _error$response3.data) === null || _error$response3$data === void 0 ? void 0 : (_error$response3$data2 = _error$response3$data.error) === null || _error$response3$data2 === void 0 ? void 0 : _error$response3$data2.message) != undefined) {\n    var _error$response4, _error$response4$data, _error$response$data3, _error$response$data4;\n    returnErrorResponse.status = (_error$response4 = error.response) !== null && _error$response4 !== void 0 && (_error$response4$data = _error$response4.data) !== null && _error$response4$data !== void 0 && _error$response4$data.status ? error.response.data.status : null;\n    returnErrorResponse.message = (_error$response$data3 = error.response.data) === null || _error$response$data3 === void 0 ? void 0 : (_error$response$data4 = _error$response$data3.error) === null || _error$response$data4 === void 0 ? void 0 : _error$response$data4.message;\n  } else if ((error === null || error === void 0 ? void 0 : (_error$response5 = error.response) === null || _error$response5 === void 0 ? void 0 : (_error$response5$data = _error$response5.data) === null || _error$response5$data === void 0 ? void 0 : _error$response5$data.message) != undefined) {\n    returnErrorResponse.status = error.response.data.status ? error.response.data.status : null;\n    returnErrorResponse.message = error.response.data.message;\n  } else if ((error === null || error === void 0 ? void 0 : (_error$response6 = error.response) === null || _error$response6 === void 0 ? void 0 : _error$response6.data) != undefined) {\n    returnErrorResponse.status = error.response.data.status ? error.response.data.status : null;\n    returnErrorResponse.message = jsonToString(error.response.data);\n  } else if (((error === null || error === void 0 ? void 0 : error.name) === 'Error' || (error === null || error === void 0 ? void 0 : error.name) === \"AxiosError\") && (error === null || error === void 0 ? void 0 : error.message) === \"Network Error\") {\n    //localStorageService.clearToken();\n    //localStorageService.clearLocalStorage();\n  }\n  return returnErrorResponse;\n};\nconst jsonToString = data => {\n  if (typeof data == \"object\") {\n    const keys = Object.keys(data);\n    const message = [];\n    if (keys && keys.length > 0) {\n      keys.forEach(keyName => {\n        message.push(data[keyName]);\n      });\n    }\n    return message.join('\\n');\n  }\n  return data;\n};","map":{"version":3,"names":["axios","LocalStorageService","config","apiURL","Message","localStorageService","getService","axiosInstance","create","baseURL","headers","interceptors","request","use","token","getAccessToken","error","Promise","reject","response","originalRequest","status","_retry","refreshToken","getRefreshToken","method","url","LOGIN_REFRESH_TOKEN","data","then","setTokenAfterRefreshToken","access","defaults","common","Authorization","catch","clearToken","clearLocalStorage","window","location","handleError","_error$response","_error$response$data","_error$response3","_error$response3$data","_error$response3$data2","_error$response5","_error$response5$data","_error$response6","returnErrorResponse","message","detail","undefined","_error$response$data2","_error$response2","_error$response2$data","PLAN_EXPIRED","ALL_CREDITS_USED","_error$response4","_error$response4$data","_error$response$data3","_error$response$data4","jsonToString","name","keys","Object","length","forEach","keyName","push","join"],"sources":["C:/Users/Acer/OneDrive/Desktop/busresp/onboardFrontend/src/services/interceptor.service.js"],"sourcesContent":["import axios from \"axios\";\nimport LocalStorageService from './localstorage.service';\nimport { config } from '../configs'\nimport { apiURL } from '../configs'\nimport { Message } from \"../utility/constants/message\";\n\nconst localStorageService = LocalStorageService.getService();\n\nexport const axiosInstance = axios.create({\n  baseURL: config.baseURL,\n  headers: {\n    \"Content-Type\": \"application/json\"\n  }\n});\n\naxiosInstance.interceptors.request.use(\n    config=>{\n        const token = localStorageService.getAccessToken();\n        if (token) {\n            config.headers['Authorization'] = 'Bearer ' + token;\n        }\n        return config;\n    }, error => {\n        Promise.reject(error)\n    }\n);\n\naxiosInstance.interceptors.response.use((response) => {\n        return response\n    }, \n    function(error){\n        const originalRequest = error.config;\n        if(error && error.response &&  error.response.status === 401 && !originalRequest._retry){\n            originalRequest._retry = true;\n            const refreshToken = localStorageService.getRefreshToken();\n            var headers = {\n                //Authorization: 'Bearer ' + refreshToken,\n                // refresh: refreshToken\n                'Content-type': 'application/json'\n            }\n\n            return axios({\n              method: 'post',\n              url: apiURL.LOGIN_REFRESH_TOKEN,\n              data: {\n                'refresh': refreshToken\n              },\n              headers: headers\n            }).then(response=>{\n                if(response.status === 200){\n                    localStorageService.setTokenAfterRefreshToken(response.data.access);\n                    axios.defaults.headers.common['Authorization'] = 'Bearer ' + response.data.access;                    \n                    originalRequest.headers.Authorization = 'Bearer ' + response.data.access;\n                    return axios(originalRequest);\n                }\n            }).catch(error=>{\n                localStorageService.clearToken();\n                localStorageService.clearLocalStorage();\n                window.location = '/';\n            });\n        }\n\n        return Promise.reject(handleError(error));\n    }\n);\n\nconst handleError = (error) => {\n    const returnErrorResponse = {status: 'Failed', message: 'Oops!!! Something went wrong at our end. Please try again after a minute'};\n    if(error?.response?.data?.detail != undefined){\n        returnErrorResponse.status  = error.response.data?.status ? error.response?.data?.status : null;\n        if(error.response.data.detail == \"PLAN_EXPIRED\"){\n            returnErrorResponse.message = Message.PLAN_EXPIRED;\n        }else if(error.response.data.detail == \"ALL_CREDITS_USED\"){\n            returnErrorResponse.message =  Message.ALL_CREDITS_USED\n        }else{\n            returnErrorResponse.message = error.response.data.detail;\n        }\n    }else if(error?.response?.data?.error?.message != undefined){\n        returnErrorResponse.status  = error.response?.data?.status ? error.response.data.status : null;\n        returnErrorResponse.message = error.response.data?.error?.message;\n    }else if(error?.response?.data?.message != undefined){\n        returnErrorResponse.status  = error.response.data.status ? error.response.data.status : null;\n        returnErrorResponse.message = error.response.data.message;\n    }else if(error?.response?.data != undefined){\n        returnErrorResponse.status  = error.response.data.status ? error.response.data.status : null;\n        returnErrorResponse.message = jsonToString(error.response.data);\n    }else if((error?.name === 'Error' || error?.name === \"AxiosError\") && error?.message === \"Network Error\"){\n        //localStorageService.clearToken();\n        //localStorageService.clearLocalStorage();\n        \n    }\n\n    return returnErrorResponse;\n}\n\nconst jsonToString = (data) => {\n    if(typeof data == \"object\"){\n        const keys = Object.keys(data);\n        const message = [];\n        if(keys && keys.length > 0){\n            keys.forEach(keyName=>{\n                message.push(data[keyName])\n            })\n        }\n        return message.join('\\n');\n    }\n\n    return data;\n    \n    \n}\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}